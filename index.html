<!doctype html>
<html lang="pl">
<head>
<meta charset="utf-8">
<title>Pixelowa Biblioteka ‚Äì Arcade</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<style>
:root{color-scheme:dark}
body{margin:0;background:#050a07;font-family:system-ui}
.wrap{display:flex;min-height:100vh;align-items:center;justify-content:center;padding:16px}
.hud{width:min(1100px,96vw);display:flex;gap:10px;flex-wrap:wrap;color:#eafff2;margin-bottom:10px}
.pill{background:#0e2a1c;border:1px solid #1f5a3b;border-radius:999px;padding:6px 12px}
canvas{width:min(1100px,96vw);aspect-ratio:16/10;image-rendering:pixelated;
border-radius:18px;border:1px solid #1f5a3b;background:#0b2418;
box-shadow:0 20px 60px rgba(0,0,0,.6)}
button{background:#0e2a1c;color:#eafff2;border:1px solid #1f5a3b;
border-radius:10px;padding:6px 10px;cursor:pointer}
button:hover{filter:brightness(1.15)}
</style>
</head>
<body>
<div class="wrap">
<div>
<div class="hud">
<div class="pill">üìö <span id="score">0</span>/<span id="total">0</span></div>
<div class="pill">‚ù§Ô∏è <span id="lives">3</span></div>
<div class="pill">‚è± <span id="time">0.0</span>s</div>
<div class="pill">WASD / strza≈Çki ¬∑ Shift sprint ¬∑ R restart</div>
<button onclick="reset(true)">Restart</button>
</div>
<canvas id="game" width="960" height="600"></canvas>
</div>
</div>

<script>
const c=document.getElementById("game"),ctx=c.getContext("2d");
const scoreEl=score=document.getElementById("score"),
totalEl=document.getElementById("total"),
livesEl=document.getElementById("lives"),
timeEl=document.getElementById("time");

const TILE=24, MAP_W=40, MAP_H=25;
let map=[], books=[], guards=[];
let score=0,lives=3,startTime=0,lastT=0,running=true;

const keys=new Set();
onkeydown=e=>{keys.add(e.key.toLowerCase());if(e.key==="r")reset(true)};
onkeyup=e=>keys.delete(e.key.toLowerCase());

const player={x:48,y:48,w:16,h:18,speed:160,inv:0,vx:0,vy:0};

function rand(a,b){return Math.floor(Math.random()*(b-a+1))+a}
function tile(px,py){return map[Math.floor(py/TILE)]?.[Math.floor(px/TILE)]??1}
function wall(px,py){return tile(px,py)===1||tile(px,py)===3}
function overlap(a,b){return a.x<a.w+b.x&&a.x+a.w>b.x&&a.y<a.h+b.y&&a.y+a.h>b.y}

function buildMap(){
map=Array.from({length:MAP_H},()=>Array(MAP_W).fill(0));
for(let x=0;x<MAP_W;x++){map[0][x]=1;map[MAP_H-1][x]=1}
for(let y=0;y<MAP_H;y++){map[y][0]=1;map[y][MAP_W-1]=1}
for(let y=4;y<MAP_H;y+=4)
for(let x=2;x<MAP_W-2;x++)
if(x%8)map[y][x]=map[y+1]?.[x]=1;

for(let i=0;i<10;i++){let x=rand(2,MAP_W-3),y=rand(2,MAP_H-3);
if(!map[y][x])map[y][x]=3}

for(let i=0;i<14;i++){let x=rand(2,MAP_W-3),y=rand(2,MAP_H-3);
if(!map[y][x])map[y][x]=2}
}

function placeBooks(){
books=[];score=0;
totalEl.textContent=14;
while(books.length<14){
let x=rand(2,MAP_W-3),y=rand(2,MAP_H-3);
if(map[y][x]===0&&!books.some(b=>b.x===x&&b.y===y))
books.push({x,y,c:0});
}
}

function placeGuards(){
guards=[];
const types=[
{t:"normal",s:120},
{t:"fast",s:170},
{t:"scout",s:110}
];
for(let i=0;i<6;i++){
let x=rand(10,MAP_W-10),y=rand(5,MAP_H-5);
guards.push({
x:x*TILE+4,y:y*TILE+4,w:16,h:16,
vx:0,vy:0,dir:rand(0,3),
...types[i%3]
});
}
}

function reset(full){
buildMap();placeBooks();placeGuards();
player.x=48;player.y=48;player.inv=0;
lives=3;livesEl.textContent=lives;
if(full){startTime=performance.now();lastT=startTime}
running=true;
}

function move(o,dt){
o.x+=o.vx*dt;if(wall(o.x,o.y)||wall(o.x+o.w,o.y+o.h))o.x-=o.vx*dt;
o.y+=o.vy*dt;if(wall(o.x,o.y)||wall(o.x+o.w,o.y+o.h))o.y-=o.vy*dt;
}

function updatePlayer(dt){
let dx=(keys.has("a")||keys.has("arrowleft"))*-1+(keys.has("d")||keys.has("arrowright"));
let dy=(keys.has("w")||keys.has("arrowup"))*-1+(keys.has("s")||keys.has("arrowdown"));
if(dx||dy){let l=Math.hypot(dx,dy);dx/=l;dy/=l}
let sp=player.speed+(keys.has("shift")?70:0);
if(tile(player.x+8,player.y+9)===2)sp*=0.55;
player.vx=dx*sp;player.vy=dy*sp;
move(player,dt);
}

function updateGuards(dt){
for(const g of guards){
if(Math.random()<0.02)g.dir=rand(0,3);
const dirs=[[1,0],[-1,0],[0,1],[0,-1]][g.dir];
g.vx=dirs[0]*g.s;g.vy=dirs[1]*g.s;
move(g,dt);
if(Math.random()<0.01)g.dir=rand(0,3);
if(overlap(player,g)&&performance.now()>player.inv){
lives--;livesEl.textContent=lives;
player.inv=performance.now()+1000;
player.x=48;player.y=48;
if(lives<=0)running=false;
}
}
}

function draw(){
ctx.clearRect(0,0,c.width,c.height);
for(let y=0;y<MAP_H;y++)for(let x=0;x<MAP_W;x++){
let px=x*TILE,py=y*TILE;
ctx.fillStyle=["#123a26","#6b4a2b","#000","#2b2b2b"][map[y][x]]||"#0e2a1c";
ctx.fillRect(px,py,TILE,TILE);
}
for(const b of books)if(!b.c){
ctx.fillStyle="#f1c40f";
ctx.fillRect(b.x*TILE+6,b.y*TILE+6,12,14);
}
for(const g of guards){
ctx.fillStyle=g.t==="fast"?"#ff7675":g.t==="scout"?"#9b59b6":"#e74c3c";
ctx.fillRect(g.x,g.y,16,16);
}
if(performance.now()>player.inv||Math.floor(performance.now()/120)%2)
{ctx.fillStyle="#2ecc71";ctx.fillRect(player.x,player.y,16,18)}
}

function loop(t){
const dt=Math.min(0.033,(t-lastT)/1000);lastT=t;
if(running){
updatePlayer(dt);updateGuards(dt);
for(const b of books)if(!b.c&&overlap(player,{x:b.x*TILE,y:b.y*TILE,w:16,h:16})){
b.c=1;score++;scoreEl.textContent=score;if(score==14)running=false}
timeEl.textContent=((t-startTime)/1000).toFixed(1);
}
draw();requestAnimationFrame(loop);
}

reset(true);requestAnimationFrame(loop);
</script>
</body>
</html>
